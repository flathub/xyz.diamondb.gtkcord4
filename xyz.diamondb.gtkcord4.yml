id: xyz.diamondb.gtkcord4
runtime: org.gnome.Platform
runtime-version: '43'
sdk: org.gnome.Sdk
command: gtkcord4

sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --share=ipc
  - --share=network
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
  - --filesystem=xdg-run/keyring
  - --device=dri

modules:
  - name: gtkcord4
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/golang/bin
      env:
        GOBIN: /app/bin
    build-commands:
      - go install -v -tags libadwaita -mod=vendor ./...
      - desktop-file-edit --set-icon=$FLATPAK_ID --remove-key=DBusActivatable nix/$FLATPAK_ID.desktop
      - install -Dm644 nix/$FLATPAK_ID.desktop /app/share/applications/$FLATPAK_ID.desktop
      - install -Dm644 internal/icons/svg/logo.svg /app/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg
      - install -Dm644 $FLATPAK_ID.metainfo.xml /app/share/metainfo/$FLATPAK_ID.metainfo.xml
    sources:
      - type: git
        url: https://github.com/diamondburned/gtkcord4
        tag: v0.0.8

      - type: patch
        use-git: true
        paths:
          - metainfo.patch
          - dm_icon.patch # to be removed after next stable release/tag

      # Workaround for Go modules generated by github.com/dennwc/flatpak-go-mod
      - type: file
        path: modules.txt
        dest: vendor

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/adaptive/@v/v0.0.2-0.20221227093656-fa139be203a8.zip
        strip-components: 3
        dest: vendor/github.com/diamondburned/adaptive
        sha256: c226baea81d59d525fc94dc1c60dac111cac0aa19784044abeb3d188643c6c20

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/arikawa/v3/@v/v3.2.1-0.20230131081350-00c3ed4b8afd.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/arikawa/v3
        sha256: 87d9a206567b22144919a956e8632e9f8c69df09d3804f2d6d3fadd1090944e0

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/gotk4/pkg/@v/v0.0.5-0.20230105054822-f46414fdaa94.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/gotk4/pkg
        sha256: b2ea80018eafc4ec7f2cddd92a683f54635fd2caeaadc148c350b092caeea9e9

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/gotkit/@v/v0.0.0-20230131094355-0f2a6e285d1e.zip
        strip-components: 3
        dest: vendor/github.com/diamondburned/gotkit
        sha256: d6ff54aba84bc7d147aae3b37606836b133a0371b02884ebc0867963d99d4e72

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/ningen/v3/@v/v3.0.1-0.20230124093205-d39554fd5d67.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/ningen/v3
        sha256: 6abb478700c3f6f8d242e778259be31eb84d0aacd88790bb9d73d3514e20c43f

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/chatkit/@v/v0.0.0-20221220124033-97528a3fd110.zip
        strip-components: 3
        dest: vendor/github.com/diamondburned/chatkit
        sha256: f14852d5d54fad00d36364c5f8ba562a46aaf4197e502b062e833daca80b17f8

      - type: archive
        url: https://proxy.golang.org/github.com/diamondburned/gotk4-adwaita/pkg/@v/v0.0.0-20230105075138-e92a3b568c9e.zip
        strip-components: 4
        dest: vendor/github.com/diamondburned/gotk4-adwaita/pkg
        sha256: 0379c283ebd460f74c3c9a81976ebdf43498aab7dea2ae475647b3f0d336cc4b

      - type: archive
        url: https://proxy.golang.org/github.com/dustin/go-humanize/@v/v1.0.0.zip
        strip-components: 3
        dest: vendor/github.com/dustin/go-humanize
        sha256: e01916e082a6646ea12d7800d77af43045c27284ff2a0a77e3484509989cc107

      - type: archive
        url: https://proxy.golang.org/github.com/enescakir/emoji/@v/v1.0.0.zip
        strip-components: 3
        dest: vendor/github.com/enescakir/emoji
        sha256: 139773b47fe8132ccb980ae91e1c146dc6f0f430633ece25db4bb385baba4867

      - type: archive
        url: https://proxy.golang.org/github.com/ianlancetaylor/cgosymbolizer/@v/v0.0.0-20220405231054-a1ae3e4bba26.zip
        strip-components: 3
        dest: vendor/github.com/ianlancetaylor/cgosymbolizer
        sha256: a5bda5bbba9e412463eb4800e7c28f575c3743d211f5ffc40a652254b6d6c00f

      - type: archive
        url: https://proxy.golang.org/github.com/pkg/errors/@v/v0.9.1.zip
        strip-components: 3
        dest: vendor/github.com/pkg/errors
        sha256: d4c36b8bcd0616290a3913215e0f53b931bd6e00670596f2960df1b44af2bd07

      - type: archive
        url: https://proxy.golang.org/github.com/sahilm/fuzzy/@v/v0.1.0.zip
        strip-components: 3
        dest: vendor/github.com/sahilm/fuzzy
        sha256: 82c8b592ff10966ec1639dea6b5f925706a4901583dc15060ac00392e6693498

      - type: archive
        url: https://proxy.golang.org/github.com/yuin/goldmark/@v/v1.4.13.zip
        strip-components: 3
        dest: vendor/github.com/yuin/goldmark
        sha256: bb41a602b174345fda392c8ad83fcc93217c285c763699677630be90feb7a5e3

      - type: archive
        url: https://proxy.golang.org/github.com/alecthomas/chroma/@v/v0.10.0.zip
        strip-components: 3
        dest: vendor/github.com/alecthomas/chroma
        sha256: beb07b996ee33bc052fe039c93d1c0726e61bcc4819ca39f7bf63304f2ae8c49

      - type: archive
        url: https://proxy.golang.org/github.com/alessio/shellescape/@v/v1.4.1.zip
        strip-components: 3
        dest: vendor/github.com/alessio/shellescape
        sha256: e28d444e73b803a15cf83e6179149d34c6c132baa60cb8137e5f0aea50a543bf

      - type: archive
        url: https://proxy.golang.org/github.com/danieljoos/wincred/@v/v1.1.0.zip
        strip-components: 3
        dest: vendor/github.com/danieljoos/wincred
        sha256: 24f8b136d30eeea7af02e33c26a83c73c8f70dea30cb1c889e8a674f380587aa

      - type: archive
        url: https://proxy.golang.org/github.com/dlclark/regexp2/@v/v1.4.0.zip
        strip-components: 3
        dest: vendor/github.com/dlclark/regexp2
        sha256: 02e1eab44b19362c7c04ea41dffa66a3f7d3239d4e5bebe44db94116455ee561

      - type: archive
        url: https://proxy.golang.org/github.com/godbus/dbus/v5/@v/v5.0.6.zip
        strip-components: 4
        dest: vendor/github.com/godbus/dbus/v5
        sha256: 0097f9b4608dc4bf5ca63cd3a9f3334e5cff6be2cab6170cdef075ef97075d89

      - type: archive
        url: https://proxy.golang.org/github.com/gorilla/schema/@v/v1.2.0.zip
        strip-components: 3
        dest: vendor/github.com/gorilla/schema
        sha256: f47ffecf97cffd0f557c6ed2b541234fa10a1a3d51ae769216987ff7e07c23a9

      - type: archive
        url: https://proxy.golang.org/github.com/gorilla/websocket/@v/v1.4.2.zip
        strip-components: 3
        dest: vendor/github.com/gorilla/websocket
        sha256: d0d1728deaa06dac190bf4964c9c6395923403eae337cb3305d6dda18ef07337

      - type: archive
        url: https://proxy.golang.org/github.com/kylelemons/godebug/@v/v1.1.0.zip
        strip-components: 3
        dest: vendor/github.com/kylelemons/godebug
        sha256: dbbd0ce8c2f4932bb03704d73026b21af12bd68d5b8f4798dbf10a487a2b6d13

      - type: archive
        url: https://proxy.golang.org/github.com/twmb/murmur3/@v/v1.1.3.zip
        strip-components: 3
        dest: vendor/github.com/twmb/murmur3
        sha256: 5a36acf51b1d82db1f8a0bbd5b7c4ed5e97416d2b2a57ef14ccaeb52e5d35b96

      - type: archive
        url: https://proxy.golang.org/github.com/zalando/go-keyring/@v/v0.2.1.zip
        strip-components: 3
        dest: vendor/github.com/zalando/go-keyring
        sha256: 53f2a7ef46f9fcd73b6880f532d9ffa41b55a9244d8e8b1ce73cdbbdec2b9df2

      - type: archive
        url: https://proxy.golang.org/go4.org/@v/v0.0.0-20200411211856-f5505b9728dd.zip
        strip-components: 1
        dest: vendor/go4.org
        sha256: 709687824a6f7d7d130c50dab26cd12a74ba0220833916bb0acdf39b0375cd13

      - type: archive
        url: https://proxy.golang.org/go4.org/unsafe/assume-no-moving-gc/@v/v0.0.0-20220617031537-928513b29760.zip
        strip-components: 3
        dest: vendor/go4.org/unsafe/assume-no-moving-gc
        sha256: 9798c920f1f226220c5479278c868ebeda8e1b94b6947adedae4b56789adcb7c

      - type: archive
        url: https://proxy.golang.org/golang.org/x/crypto/@v/v0.1.0.zip
        strip-components: 3
        dest: vendor/golang.org/x/crypto
        sha256: d3931b10979096640867809147e8c7d0f1c8bc0dd3d400947e01c29eefa6898e

      - type: archive
        url: https://proxy.golang.org/golang.org/x/image/@v/v0.0.0-20220902085622-e7cb96979f69.zip
        strip-components: 3
        dest: vendor/golang.org/x/image
        sha256: 0169cad235a87dc82f3b24303bcc7f1c25b9d4993d9a503ce7310815dba86f0f

      - type: archive
        url: https://proxy.golang.org/golang.org/x/mod/@v/v0.6.0.zip
        strip-components: 3
        dest: vendor/golang.org/x/mod
        sha256: 3f45c4fd992e55f087484632cb6bf19f5bba68e51bd18a2f3e10c88771eec268

      - type: archive
        url: https://proxy.golang.org/golang.org/x/sync/@v/v0.0.0-20220601150217-0de741cfad7f.zip
        strip-components: 3
        dest: vendor/golang.org/x/sync
        sha256: 2ea9ee4a150eceea9430ebb125830fd1eb2bfd8361127032838ef5907ad93f33

      - type: archive
        url: https://proxy.golang.org/golang.org/x/sys/@v/v0.1.0.zip
        strip-components: 3
        dest: vendor/golang.org/x/sys
        sha256: e7cbe58ed3745ba63d482fe82603119bd635f9a5dd914ed95a4c1826fdcf54a7

      - type: archive
        url: https://proxy.golang.org/golang.org/x/text/@v/v0.4.0.zip
        strip-components: 3
        dest: vendor/golang.org/x/text
        sha256: 16af01ae1aacbb027662d39662bd52e92e288ba4ce104ea0116534a81dfd3c30

      - type: archive
        url: https://proxy.golang.org/golang.org/x/time/@v/v0.0.0-20210723032227-1f47c861a9ac.zip
        strip-components: 3
        dest: vendor/golang.org/x/time
        sha256: e5d8ade42804ec7d96a632c031dde7db087e8bc4cd5dfd6f38df03ce4f16d9b6

      - type: archive
        url: https://proxy.golang.org/golang.org/x/tools/@v/v0.2.0.zip
        strip-components: 3
        dest: vendor/golang.org/x/tools
        sha256: 05da23611d775b2d3771438fa2e5e522cc948a35372cb7ad019fe484f1e91ae0
